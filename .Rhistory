?diff.difftime()
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = diff.difftime(end_date,start_date,units = "mins"))
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = difftime(end_date,start_date,units = "mins"))
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = difftime(end_date,start_date,units = "mins")) %>% select(time)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = difftime(start_date-end_date,units = "mins"))
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = difftime(start_date,end_date,units = "mins"))
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = difftime(start_date,end_date,units = "mins")) %>% select(time)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = difftime(start_date,end_date,units = "mins")) %>% select(time) %>% mutate(time=as.integer(time))
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = difftime(start_date,end_date,units = "mins")) %>% select(time)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = difftime(start_date,end_date,units = "mins")) %>% select(time) %>% mutate(time=as.integer(time))
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date-end_date,units = "mins")))
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")))
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins"))) %>%
select(time,COST_AMOUNT_CENTS)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins"))) %>%
select(time,COST_AMOUNT_CENTS/100)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100) %>%
select(time,COST_AMOUNT_CENTS)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100) %>%
filter(COST > 0) %>%
select(time,COST)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100) %>%
filter(COST > 0) %>%
select(time,COST)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(time,speed)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(COST,speed)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(COST,speed)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(COST,speed) -> to_model
pacman::p_load(tidyverse, lubridate, readr,highcharter,echarts4r,echarts4r.maps,leaflet,ggmap,leaflet.extras,htmltools,broom)
modlss <- loess(COST ~ speed, data = to_model)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(COST,speed) %>%
na.omit()-> to_model
modlss <- loess(COST ~ speed, data = to_model)
?loess
modlss <- loess(COST ~ speed, data = to_model,normalize = TRUE)
modlss <- loess(COST ~ speed, data = to_model,normalize = FALSE)
to_model %>%
e_charts(speed)
to_model %>%
e_charts() %>%
e_scatter(speed,COST)
to_model %>%
e_charts(speed) %>%
e_scatter(speed,COST)
to_model %>%
e_charts(COST) %>%
e_scatter(speed,COST)
to_model %>%
e_charts(speed) %>%
e_scatter(speed,COST)
to_model %>%
e_charts(speed) %>%
e_scatter(speed,COST) %>%
e_loess(COST ~ speed, span = 0.5, color = "red")
to_model %>%
e_charts(speed) %>%
e_scatter(speed,COST) %>%
e_loess(COST ~ speed)
mtcars
to_model
to_model %>% mutate(test = COST/speed)
modlss <- loess(COST ~ speed, data = to_model)
colnames(fawaz_lime)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(start_date,COST,speed)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(start_date,COST,speed) %>% mutate(start_date = as_date(start_date))
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(start_date,COST,speed) %>% mutate(start_date = as_date(start_date)) %>% group_by(start_date)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(start_date,COST,speed) %>% mutate(start_date = as_date(start_date)) %>% group_by(start_date) %>% summarise(total_cost = sum(COST))
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(start_date,COST,speed) %>% mutate(start_date = as_date(start_date)) %>% group_by(start_date) %>% summarise(total_cost = sum(COST),avg_speed = median(speed))
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(start_date,COST,speed) %>% mutate(start_date = as_date(start_date)) %>% group_by(start_date) %>% summarise(total_cost = sum(COST),avg_speed = median(speed))-> to_model
skimr::skim(to_model)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(start_date,COST,speed) %>%
na.omit()-> to_model
skimr::skim(to_model)
to_model %>% View()
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(speed != Inf) %>%
select(start_date,COST,speed) -> to_model
modlss <- loess(COST ~ speed, data = to_model)
to_model %>%
e_charts(speed) %>%
e_scatter(speed,COST) %>%
e_loess(COST ~ speed)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(start_date,COST,speed) %>% mutate(start_date = as_date(start_date)) %>% group_by(start_date) %>% summarise(total_cost = sum(COST),avg_speed = median(speed)) %>% filter(!=Inf)-> to_model
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(start_date,COST,speed) %>% mutate(start_date = as_date(start_date)) %>% group_by(start_date) %>% summarise(total_cost = sum(COST),avg_speed = median(speed)) %>% filter(avg_speed!=Inf)-> to_model
modlss <- loess(COST ~ speed, data = to_model)
to_model
modlss <- loess(total_cost ~ avg_speed, data = to_model)
to_model %>%
e_charts(speed) %>%
e_scatter(speed,COST) %>%
e_loess(COST ~ speed)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(speed != Inf) %>%
select(start_date,COST,speed) -> to_model
modlss <- loess(total_cost ~ avg_speed, data = to_model)
modlss <- loess(COST ~ speed, data = to_model)
modlss
rrange(augment(modlss), speed) |>
mutate(.se = predict(modlss, se = TRUE)$se.fit)
arrange(augment(modlss), speed) |>
mutate(.se = predict(modlss, se = TRUE)$se.fit)
fit <- arrange(augment(modlss), speed) |>
mutate(.se = predict(modlss, se = TRUE)$se.fit)
head(fit)
hchart(
to_model,
type = "scatter",
hcaes(x = speed, y = COST)
)
fawaz_lime %>%
# select(STARTED_AT,COMPLETED_AT) %>%
filter(STATUS == "completed" & !is.na(STARTED_AT)) %>%
mutate(STARTED_AT = substr(STARTED_AT,start=1,stop=19),
COMPLETED_AT = substr(COMPLETED_AT,start=1,stop=10)) %>%
mutate(start_date = lubridate::as_datetime(STARTED_AT),
end_date = lubridate::as_datetime(COMPLETED_AT),
day_of_week = wday(start_date, label = TRUE),
month = month(start_date, label = TRUE),
quarter = quarter(start_date)) %>%
mutate(time = as.integer(difftime(start_date,end_date,units = "mins")),
COST=COST_AMOUNT_CENTS/100,
speed = DISTANCE_METERS/time) %>%
filter(COST > 0) %>%
select(start_date,COST,speed) %>% mutate(start_date = as_date(start_date)) %>% group_by(start_date) %>% summarise(total_cost = sum(COST),avg_speed = median(speed)) %>% filter(avg_speed!=Inf)-> to_model
hchart(
to_model,
type = "scatter",
hcaes(x = avg_speed, y = total_cost)
)
